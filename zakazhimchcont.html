<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Клининг АБСОЛЮТ</title>
    <link rel="stylesheet" href="zakazhimchcont.css">
    <link rel="icon" href="лого.png" type="png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spectral+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spectral+SC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Подключаем Slick CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <!-- Подключаем Slick Theme CSS (опционально, если нужна тема оформления) -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>

</head>
<body>
      <header>
        <div class="top-header">
            <div class="container">
                <div class="logo">
                   <img src="https://i.postimg.cc/jSTZZfZK/2025-04-29-185430.png" alt="Логотип САГОС коммерческий клининг">
                   <div>
                    <p><b>АБСОЛЮТ</b></p>
                    <p>клининговая компания</p>
                </div>
                </div>
               <div class="contact-info">
    <div>
        <a href="tel:+74993221889" class="phone-number-link">+7 (499) 322-18-89</a>
        <span class="phone-description">ТЕЛЕФОН ДЛЯ СВЯЗИ</span>
    </div>
    
                   
                    <div class="user-icon">
                       <a href="avtoriz.html" class="user-icon-link">  <img src="https://i.postimg.cc/66cTdg56/png-transparent-computer-icons-user-username-avatar-person-skill-1.png" alt="Иконка пользователя" width="30" height="30">
                    </div>
                </div>
            </div>
        </div>

            <nav class="main-nav">
            <div class="container">
                <ul>
                    <li>
                        <a href="oplata.html">ГЛАВНАЯ <span class="arrow"></span></a>
                        <ul class="dropdown">
                            <li><a href="vseyslygi.html">Услуги</a></li>
                            <li><a href="onas.html">О нас</a></li>
                            <li><a href="oborud.html">Наше оборудование</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="onas.html">О НАС </a>
                      
                    </li>
                  <li class="dropdown-container">
        <a href="#">Услуги <span class="arrow"></span></a>
        <ul class="dropdown multi-column">
            <li class="column">
                <span class="dropdown-header">Уборка квартир</span>
                <div class="items-container">
                   <a href="yslygi.html">Поддерживающая</a>  
                   <a href="complexc.html">Комплексная</a>
                    <a href="gener.html">Генеральная</a>
                    <a href="sroch.html">Срочная</a>
                    <a href="remont.html">После ремонта</a>
                    <a href="zasel.html">Перед заселением</a>
                    <a href="zapysh.html">Запущенных квартир</a>
                </div>
            </li>
            <li class="column">
                <span class="dropdown-header">Уборка домов</span>
                <div class="items-container">
                    <a href="cottage.html">Коттеджей</a>
                    <a href="dachi.html">Дачи</a>
                  
                </div>
            </li>
            <li class="column">
                <span class="dropdown-header">Уборка офисов</span>
                <div class="items-container">
                   <a href="standyb.html">Поддерживающая</a>             
                    <a href="genof.html">Генеральная</a>
                    <a href="dezinf.html">Дезинфекция</a>
                    <a href="postosn.html">На постоянной основе</a>
                    <a href="okno.html">Мытье окон в офисе</a>
                   <a href="vlashn.html">Влажная уборка</a>
                   
                </div>
            </li>
            <li class="column">
                <span class="dropdown-header">Уборка помещений</span>
                <div class="items-container">
                    <a href="sanat.html">Санаториев</a>
                    <a href="ybmed.html">Медицинских учреждений</a>
                </div>
            </li>
        </ul>
    </li>
                  <li class="dropdown-container">
        <a href="#">Химчистка <span class="arrow"></span></a>
        <ul class="dropdown ">
            <li class="column">
               
                <div class="items-container">
                   <a href="himcovr.html">Ковролин</a>  
                   <a href="cover.html">Ковер</a>
                    <a href="mm.html">Мягкая мебель</a>
                    <a href="cm.html">Кожанная мебель</a>
                    <a href="rychrab.html">Ковры ручной работы</a>
                    <a href="sintcovr.html">Синтетические ковры</a>
                </div>
            </li>
             
        </ul>
    </li>
                
                    <li>
                        <a href="#">ЦЕНА <span class="arrow"></span></a>
                        <ul class="dropdown">
                            <li><a href="cena.html">Прайс-лист</a></li>
                            <li><a href="calculator.html">Калькулятор</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="sposob.html">СПОСОБЫ ОПЛАТЫ </a>
                       
                    </li>
                    <li>
                        <a href="contact.html">КОНТАКТЫ </a>
    
                    </li>
                  <li>
                       <!-- SEARCH ICON -->
                       <a href="#" class="search-icon">
                           <img src="https://i.postimg.cc/8k0vHrmR/icons8-50.png"
                                alt="Поиск" width="20" height="20">
                       </a>
                       <!-- SEARCH BOX (Initially hidden) -->
                       <div class="search-box">
                           <input type="text" class="search-input" placeholder="Поиск...">
                           <span class="search-close">&times;</span>
                           <p class="search-instructions">Нажмите ввод для поиска или esc чтобы закрыть</p>
                           <div class="search-results"></div>
                       </div>
                    </li>
                </ul>
              
            </div>
        </nav>
          
    </header><div class="container">
        <h1>Оформление заказа уборки</h1>

        <!-- Индикатор шагов -->
        <div class="step-indicator-container">
            <div class="step">
                <span class="step-number">1</span>
                <span class="step-text">Параметры</span>
            </div>
            <div class="step active">
                <span class="step-number">2</span>
                <span class="step-text">Контактные данные</span>
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <span class="step-text">Оплата</span>
            </div>
        </div>
     <div class="contact-form">
            <h2>Контактные данные</h2>
            <input type="text" id="surname" name="surname" placeholder="Фамилия" required>
            <input type="text" id="name" name="name" placeholder="Имя" required>
            <input type="text" id="patronymic" name="patronymic" placeholder="Отчество">
            <input type="tel" id="phone" name="phone" placeholder="Телефон*" required>
            <input type="email" id="email" name="email" placeholder="Электронная почта*" required>
            <input type="text" id="address" name="address" placeholder="Адрес*" required>
            <button class="next-button" id="submitButton">Оформить заказ</button>
        </div>
    </div>

  <script>
        document.addEventListener('DOMContentLoaded', () => {
            const submitButton = document.getElementById('submitButton');

            if (submitButton) {
                submitButton.addEventListener('click', submitOrder);
            } else {
                console.error("Кнопка 'Оформить заказ' не найдена.");
            }

            async function createCustomer(surname, name, patronymic, phone, email, address) {
                try {
                    const response = await fetch('http://localhost:3000/customers', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            surname: surname,
                            name: name,
                            patronymic: patronymic,
                            phone: phone,
                            email: email,
                            address: address
                        })
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        console.error("Ошибка при создании клиента на сервере:", error);
                        throw new Error(`Ошибка при создании клиента: ${error.message}`);
                    }
                    const data = await response.json();
                    console.log('Клиент создан:', data);
                    return data.customerId;
                } catch (error) {
                    console.error('Ошибка:', error.message);
                    alert(`Произошла ошибка при создании клиента: ${error.message}`);
                    return null;
                }
            }

            async function submitOrder() {
                const surname = document.getElementById('surname')?.value;
                const name = document.getElementById('name')?.value;
                const patronymic = document.getElementById('patronymic')?.value;
                const phone = document.getElementById('phone')?.value;
                const email = document.getElementById('email')?.value;
                const address = document.getElementById('address')?.value;

                if (!surname || !name || !phone || !email || !address) {
                    alert("Пожалуйста, заполните все обязательные поля.");
                    return;
                }

                const customerId = await createCustomer(surname, name, patronymic, phone, email, address);
                if (!customerId) {
                    console.error('Не удалось создать клиента');
                    return;
                }

                const material = localStorage.getItem('material');
                const area = localStorage.getItem('area');
                const cleaningDate = localStorage.getItem('cleaningDate');
                const cleaningTime = localStorage.getItem('cleaningTime');
                const commentText = localStorage.getItem('commentText');
                const totalCost = localStorage.getItem('totalCost');
                 const periodicity = localStorage.getItem('periodicity');

                // Проверка totalCost
                if (!totalCost) {
                    console.error("totalCost отсутствует в localStorage!");
                    alert("Произошла ошибка: стоимость заказа не найдена. Пожалуйста, начните заново.");
                    return;
                }

                const orderData = {
                    cleaningType: material, // Используем material для cleaningType
                    square: area,
                    cleaningDate: cleaningDate,
                    cleaningTime: cleaningTime,
                    orderComment: commentText,
                    customerId: customerId,
                    totalCost: totalCost,
                    periodicity: periodicity || null //Передаем Periodicity
                };

                try {
                    const response = await fetch('http://localhost:3000/orders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(orderData)
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        console.error("Ошибка при создании заказа на сервере:", error);
                        throw new Error(`Ошибка при создании заказа: ${error.message}`);
                    }

                    const data = await response.json();
                    if (response.ok) {
                        alert('Заказ на химчистку успешно оформлен!');
                        localStorage.removeItem('material');
                        localStorage.removeItem('area');
                        localStorage.removeItem('cleaningDate');
                        localStorage.removeItem('cleaningTime');
                        localStorage.removeItem('commentText');
                        localStorage.removeItem('totalCost');
                         localStorage.removeItem('periodicity'); //Удаляем  periodicity
                        window.location.href = 'oplata.html';
                    } else {
                        alert('Ошибка при оформлении заказа: ' + data.message);
                    }
                } catch (error) {
                    console.error('Ошибка:', error.message);
                    alert("Произошла ошибка при оформлении заказа. Пожалуйста, попробуйте еще раз.");
                }
            }
 const material = localStorage.getItem('material');
            const area = localStorage.getItem('area');
            const cleaningDate = localStorage.getItem('cleaningDate');
            const cleaningTime = localStorage.getItem('cleaningTime');
            const commentText = localStorage.getItem('commentText');
           const totalCost = localStorage.getItem('totalCost');
              const periodicity = localStorage.getItem('periodicity');

        document.getElementById('display-material').textContent = material || 'Не указано';
        document.getElementById('display-area').textContent = area ? `${area} м²` : 'Не указано';
        document.getElementById('display-cleaning-date').textContent = cleaningDate || 'Не указано';
        document.getElementById('display-cleaning-time').textContent = cleaningTime || 'Не указано';
        document.getElementById('display-comment').textContent =  commentText || 'Нет комментария';
        document.getElementById('display-total-cost').textContent = totalCost + ' ₽' || 'Не указано';

  submitButton.addEventListener('click', submitOrder);

            function formatDate(date) {
                if (!date) return '';
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
                const year = date.getFullYear();
                return `${day}.${month}.${year}`;
            }
        });
    </script>
      <script>
            $(document).ready(function(){
                $('.your-class').slick({
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    dots: true,
                    infinite: true,
                    autoplay: true,
                    autoplaySpeed: 2000,
                    arrows: true,
                });
            });
        </script>
       <script>
        const searchIcon = document.querySelector('.main-nav .search-icon');
        const searchBox = document.querySelector('.main-nav .search-box');
        const searchInput = document.querySelector('.main-nav .search-input');
        const searchResultsContainer = document.createElement('div'); // Контейнер для результатов
        searchResultsContainer.classList.add('search-results');  // Добавляем класс для стилизации
        searchBox.appendChild(searchResultsContainer); // Добавляем контейнер в search-box
        const searchClose = document.querySelector('.search-close'); //  Крестик закрытия

        searchIcon.addEventListener('click', (event) => {
            event.preventDefault();
            searchBox.classList.toggle('active');
            if (searchBox.classList.contains('active')) {
                searchInput.focus();
            }
            // Очищаем предыдущие результаты при открытии поиска
            searchResultsContainer.innerHTML = '';
        });

         // Закрытие по клику на крестик
        if (searchClose) {  // Проверка, что элемент найден
            searchClose.addEventListener('click', () => {
                searchBox.classList.remove('active');
                searchInput.value = '';  // Очищаем поле поиска
                searchResultsContainer.innerHTML = ''; // Очищаем результаты
            });
        }
        // Закрытие по нажатию Esc
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                searchBox.classList.remove('active');
                searchInput.value = '';
                searchResultsContainer.innerHTML = '';
            }
        });
        function performSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            if (!searchTerm) {
                searchResultsContainer.innerHTML = ''; // Очищаем результаты, если поле поиска пустое
                return;
            }
            searchResultsContainer.innerHTML = ''; // Очищаем предыдущие результаты

            // Создаем массив для хранения результатов
            const searchResults = [];

            // Перебираем все ссылки в навигации (для примера)
            document.querySelectorAll('.main-nav a').forEach(link => {
                if (link.textContent.toLowerCase().includes(searchTerm)) {
                    searchResults.push({
                        text: link.textContent,
                        url: link.href
                    });
                }
            });
           // Добавим поиск по тексту в основном контенте (пример)
            document.querySelectorAll('h3, p, .btn-details').forEach(element => {
                if (element.textContent.toLowerCase().includes(searchTerm)) {
                    // Получаем ближайший родительский элемент с ссылкой (если есть)
                    let parentLink = element.closest('a');
                    let url = parentLink ? parentLink.href : '#'; // Используем href ссылки или '#'
                    let text = element.textContent.trim();

                    searchResults.push({
                        text: text,
                        url: url
                    });
                }
            });
            // Выводим результаты
            if (searchResults.length > 0) {
                searchResults.forEach(result => {
                    const resultElement = document.createElement('div');
                    resultElement.classList.add('search-result-item');  // Добавляем класс для стилизации
                    const linkElement = document.createElement('a');
                    linkElement.href = result.url;
                    linkElement.textContent = result.text;
                    linkElement.target = '_blank'; // Открываем в новой вкладке
                    resultElement.appendChild(linkElement);
                    searchResultsContainer.appendChild(resultElement);
                });
            } else {
                const noResultsElement = document.createElement('div');
                noResultsElement.textContent = 'Ничего не найдено.';
                searchResultsContainer.appendChild(noResultsElement);
            }
        }

        searchInput.addEventListener('input', performSearch); // Поиск при вводе
        searchInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                performSearch();
            }
        });
    </script>
</body>

</html>